---
import type { ProcessedSection } from "@/types/contentful-v2";
import { ArrowRightIcon } from "@lucide/astro";
import Section from "@/components/Section.astro";
import { documentToHtmlString } from "@contentful/rich-text-html-renderer";
import ComparisonTable from "@/components/ComparisonTable";
import { cn } from "@/lib/utils";
import { Image } from "astro:assets";
import { ArrowRightCircleIcon } from "lucide-react";

interface Props {
  section: ProcessedSection;
  slug: string;
  color: string;
}

const { section, slug, color } = Astro.props;

// Import all logos from assets/logos directory
const logos = import.meta.glob<{ default: ImageMetadata }>('@/assets/logos/*', { eager: true });

// Helper function to get logo path
const getLogoPath = (logoName: string) => {
  const logoPath = `/src/assets/logos/${logoName}`;
  const logo = logos[logoPath] as { default: ImageMetadata } | undefined;
  return logo?.default;
};
---

<Section title={section.title || ""}>
  <div class="flex flex-col md:flex-row md:items-center gap-8 mb-8">
    {
      section.headline && (
        <h2 class="text-3xl md:text-4xl font-medium md:mb-6 max-w-sm">
          {section.headline}
        </h2>
      )
    }

    <div
      class={cn("rounded-full flex items-center justify-center w-8 h-8 transform rotate-90 md:rotate-0", {
        "bg-brand-yellow": color === "brand-yellow",
        "bg-brand-blue": color === "brand-blue",
        "bg-brand-orange": color === "brand-orange",
        "bg-brand-purple": color === "brand-purple",
        "bg-brand-green": color === "brand-green",
      })}
    >
      <ArrowRightIcon class="current-color w-4 h-4 mx-2" />
    </div>

    {
      section.subtitle && (
        <div
          class="font-mono text-sm text-foreground"
          set:html={section.subtitle}
        />
      )
    }
  </div>

  <hr class="my-8" />

  <div>
    {
      section.metadata && (
        <div class="space-y-4 md:space-y-12 grid md:grid-cols-2 gap-4 md:gap-8">
          {Object.entries(section.metadata).map(([category, integrations]) => (
            <div>
              <h3 class="text-lg text-gray-900 mb-4">{category}</h3>
              <div class="grid grid-cols-2 lg:grid-cols-3 gap-4" data-animate="stagger">
                {integrations.map((integration: any) => {
                  const logoSrc = getLogoPath(integration.logo);
                  return (
                    <div class="flex flex-col items-center justify-center p-6 rounded-xl border border-gray-900 hover:border-gray-300 transition-all duration-200 bg-gray-50">
                      <div class="h-16 w-16 mb-4 flex items-center justify-center">
                        {logoSrc ? (
                          <Image 
                            src={logoSrc} 
                            alt={integration.name}
                            class="h-12 w-auto object-contain"
                          />
                        ) : (
                          <div class="text-xs text-gray-400 text-center">Logo not found</div>
                        )}
                      </div>
                      <p class="text-sm font-medium text-gray-900 text-center truncate">
                        {integration.name}
                      </p>
                    </div>
                  );
                })}
              </div>
            </div>
          ))}
          
            <!-- CTA Section --> 
            <div>
                <h3 class="text-lg text-gray-900 mb-4">&nbsp;</h3>
            <div class="border border-gray-900 bg-background rounded-lg p-6">
                <div class="text-sm text-gray-600 mb-4 font-mono" set:html={
                    documentToHtmlString(section.description)
                } />
                <a
                    href={
                        section.primaryButton?.url
                    }
                    class={
                      cn("inline-flex items-center group justify-center rounded-full text-sm font-medium bg-gray-900 text-white hover:bg-gray-800 h-10 px-6 py-2 transition-colors duration-300 ease-in-out", {
                    "hover:bg-brand-purple": color === "brand-purple",
                    "hover:bg-brand-blue": color === "brand-blue",
                    "hover:bg-brand-orange hover:text-black": color === "brand-orange",
                    "hover:bg-brand-yellow hover:text-black": color === "brand-yellow",
                    "hover:bg-brand-green hover:text-black": color === "brand-green",
                  })
                    }
                >
                    Get In Touch
                    <ArrowRightCircleIcon
                  className={cn("", {
                    "w-5 h-5 ml-4 text-brand-purple group-hover:text-white": color === "brand-purple",
                    "w-5 h-5 ml-4 text-brand-blue group-hover:text-white": color === "brand-blue",
                    "w-5 h-5 ml-4 text-brand-orange group-hover:text-black": color === "brand-orange",
                    "w-5 h-5 ml-4 text-brand-yellow group-hover:text-black": color === "brand-yellow",
                    "w-5 h-5 ml-4 text-brand-green group-hover:text-black": color === "brand-green",
                  })}
                />
                </a>
            </div>
            </div>
        </div>
      )
    }
  </div>

  
</Section>
