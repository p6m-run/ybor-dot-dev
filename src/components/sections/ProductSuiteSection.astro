---
import type { ProcessedSection } from '@/types/contentful-v2';
import { ArrowRightIcon, MoveRightIcon } from 'lucide-react';
import Section from '@/components/Section.astro';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';
import { Image } from 'astro:assets';

// Default product logos (fallback if not provided)
import YEdeLogo from '@/assets/y-ede-logo.svg';
import YInfraLogo from '@/assets/y-infra-logo.svg';
import YAppLogo from '@/assets/y-app-logo.svg';
import YAiLogo from '@/assets/y-ai-logo.svg';

interface Props {
  section: ProcessedSection;
}

const { section } = Astro.props;

const defaultLogos = [YEdeLogo, YInfraLogo, YAppLogo, YAiLogo];
---

<Section title={section.title || ''}>
  <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6" data-animate="stagger">
    {section.items?.map((product, index) => (
      <div 
        class="border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-shadow"
        style={product.metadata?.color ? `border-color: ${product.metadata.color}` : ''}
      >
        <div class="mb-4">
          {product.image ? (
            <img src={product.image.url} alt={product.image.alt} class="h-12" />
          ) : defaultLogos[index] && (
            <Image src={defaultLogos[index]} alt={product.title || `Product ${index + 1}`} class="h-12" />
          )}
        </div>
        
        {product.title && (
          <h3 class="text-xl font-semibold mb-2">{product.title}</h3>
        )}
        
        {product.subtitle && (
          <p class="text-sm text-gray-600 mb-4">{product.subtitle}</p>
        )}
        
        {product.description && (
          <div 
            class="text-sm text-gray-600 mb-4 font-mono"
            set:html={typeof product.description === 'string' 
              ? product.description 
              : documentToHtmlString(product.description)}
          />
        )}
        
        {product.metadata?.features && product.metadata.features.length > 0 && (
          <ul class="text-xs text-gray-600 space-y-1 mb-4">
            {product.metadata.features.map((feature: any) => (
              <li class="flex items-start">
                <ArrowRightIcon className="w-3 h-3 mr-2 mt-0.5 flex-shrink-0" />
                <span>{feature.title || feature}</span>
              </li>
            ))}
          </ul>
        )}
        
        {product.url && (
          <a 
            href={product.url}
            class="inline-flex items-center text-sm font-medium hover:underline"
            style={product.metadata?.color ? `color: ${product.metadata.color}` : ''}
          >
            Learn more
            <MoveRightIcon className="w-4 h-4 ml-1" />
          </a>
        )}
      </div>
    ))}
  </div>
</Section>

