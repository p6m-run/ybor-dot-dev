---
import Logo from "./Brand"
import YInfraLogo from "@/assets/y-infra-logo.svg";
import YAppLogo from "@/assets/y-app-logo.svg";
import YAiLogo from "@/assets/y-ai-logo.svg";
import YEdeLogo from "@/assets/y-ede-logo.svg";
import { Image } from "astro:assets";
import { getHomepageData } from "@/lib/contentful";
import { ArrowRightIcon, MenuIcon, XIcon } from "@lucide/astro";

const products = [
  {
    name: "Y_Infra",
    description: "Y_Infra is a platform for building and deploying infrastructure.",
    url: "/products/y-infra"
  },
  {
    name: "Y_App",
    description: "Y_App is a platform for building and deploying applications.",
    url: "/products/y-app"
  },
  {
    name: "Y_AI",
    description: "Y_AI is a platform for building and deploying AI applications.",
    url: "/products/y-ai"
  },
  {
    name: "Y_EDE",
    description: "Y_EDE is a platform for building and deploying EDE applications.",
    url: "/products/ede"
  }
]

---
<!-- Header -->
    <header>
      <div
        class="mx-auto p-6 flex items-center justify-between"
      >
        <div class="flex items-center gap-8">
          <div class="text-xl font-bold font-mono">
            <a href="/"> <Logo /></a>
          </div>
          <nav class="hidden lg:flex items-center gap-6">
            <!-- Products Mega Menu -->
            {
              products && (<div class="relative group" id="desktop-products-menu">
              <button
                id="desktop-products-toggle"
                class="flex items-center gap-1 text-sm text-gray-700 hover:text-brand-purple transition-colors  relative after:bg-brand-purple after:absolute after:h-0.5 after:w-0 after:-bottom-2 after:left-0 hover:after:w-full after:transition-all after:duration-300 cursor-pointer"
              >
                Products
                <svg
                  id="desktop-products-arrow"
                  class="w-4 h-4 transition-transform group-hover:rotate-180"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
              
              <!-- Mega Menu -->
              <div id="desktop-mega-menu" class="absolute top-full left-0 mt-2 w-[800px] max-w-[90vw] bg-white rounded-xl shadow-2xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 z-50">
                <div class="p-8">
                  <div class="grid gap-8">
                    <!-- Left Section - Products -->
                    <div>
                      <h3 class="text-2xl font-medium text-gray-900 mb-2">Products</h3>
                      <p class="text-gray-600 mb-6 text-sm">
                        Accelerate your business with our comprehensive platform solutions.
                      </p>
                      
                      <!-- Product Cards Grid -->
                      <div class="grid grid-cols-2 gap-4">
                        <!-- Y_Infra Card -->
                        <a href="/products/infra" class="group/card p-4 rounded-lg border border-gray-200 hover:bg-brand-blue/5 hover:border-brand-blue transition-all duration-200">
                          <div class="flex items-center justify-start mb-3">
                            <Image src={YInfraLogo} alt={products[0].name || "--"} class="h-8 w-auto" />
                          </div>
                          <p class="text-xs text-gray-600">
                            {products[0].description || "--"}
                          </p>
                        </a>
                        
                        <!-- Y_App Card -->
                        <a href="/products/app" class="group/card p-4 rounded-lg border border-gray-200 hover:bg-brand-green/5 hover:border-brand-green transition-all duration-200">
                          <div class="flex items-center justify-start mb-3">
                            <Image src={YAppLogo} alt={products[1].name || "--"} class="h-8 w-auto" />
                          </div>
                          <p class="text-xs text-gray-600">
                            {products[1].description || "--"}
                          </p>
                        </a>
                        
                        <!-- Y_AI Card -->
                        <a href="/products/ai" class="group/card p-4 rounded-lg border border-gray-200 hover:bg-brand-orange/5 hover:border-brand-orange transition-all duration-200">
                          <div class="flex items-center justify-start mb-3">
                            <Image src={YAiLogo} alt={products[2].name || "--"} class="h-8 w-auto" />
                          </div>
                          <p class="text-xs text-gray-600">
                            {products[2].description || "--"}
                          </p>
                        </a>
                        
                        <!-- Y_EDE Card -->
                        <a href="/products/ede" class="group/card p-4 rounded-lg border border-gray-200 hover:bg-brand-yellow/5 hover:border-brand-yellow transition-all duration-200">
                          <div class="flex items-center justify-start mb-3">
                            <Image src={YEdeLogo} alt={products[3].name || "--"} class="h-8 w-auto" />
                          </div>
                          <p class="text-xs text-gray-600">
                            {products[3].description || "--"}
                          </p>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>)
            }
            
            <a href="/culture-and-careers" class="text-sm text-gray-700 hover:text-brand-purple transition-colors relative after:bg-brand-purple after:absolute after:h-0.5 after:w-0 after:-bottom-2 after:left-0 hover:after:w-full after:transition-all after:duration-300 cursor-pointer"
              >Culture / Careers</a
            >
            <a href="/contact" class="text-sm text-gray-700 hover:text-brand-purple transition-colors relative after:bg-brand-purple after:absolute after:h-0.5 after:w-0 after:-bottom-2 after:left-0 hover:after:w-full after:transition-all after:duration-300 cursor-pointer"
              >Contact</a
            >
          </nav>
        </div>
        <div class="flex items-center md:gap-3">
          <a href="/contact"
            class="md:inline-flex hidden items-center justify-center rounded-full text-sm font-medium border border-primary bg-transparent hover:bg-primary/5  hover:text-primary transition-colors h-10 px-6 py-2"
          >
            Get Started
            <ArrowRightIcon class="w-4 h-4 ml-4" />
          </a>
          <!-- <button
            class="inline-flex items-center justify-center rounded-full text-sm font-medium hover:bg-primary/5 hover:text-primary transition-colors h-10 px-4 py-2"
          >
            Log In
          </button> -->

          <!-- menu button -->
          <button
            id="mobile-menu-button"
            class="lg:hidden inline-flex items-center justify-center rounded-full text-sm font-medium hover:bg-primary/5 hover:text-primary transition-colors h-10 px-4 py-2"
          >
            <MenuIcon class="w-5 h-5" />
          </button>
        </div>
      </div>
    </header>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="fixed inset-0 z-50 md:hidden transform translate-x-full transition-transform duration-300 ease-in-out"
    >
      <!-- Backdrop -->
      <div
        id="mobile-menu-backdrop"
        class="absolute inset-0 bg-black/50 backdrop-blur-sm opacity-0 transition-opacity duration-300"
      ></div>
      
      <!-- Menu Content -->
      <div class="absolute right-0 top-0 h-full w-[80%] max-w-sm bg-white shadow-2xl overflow-y-auto">
        <!-- Header -->
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
          <a href="/">
            <Logo />
          </a>
          <button
            id="mobile-menu-close"
            class="inline-flex items-center justify-center rounded-full text-sm font-medium hover:bg-primary/5 hover:text-primary transition-colors h-10 w-10"
          >
            <XIcon class="w-5 h-5" />
          </button>
        </div>

        <!-- Navigation -->
        <nav class="p-6 space-y-6">
          <!-- Products Section -->
          <div>
            <button
              id="mobile-products-toggle"
              class="flex items-center justify-between w-full text-left text-base font-medium text-gray-900 mb-3"
            >
              Products
              <svg
                id="mobile-products-arrow"
                class="w-5 h-5 transition-transform"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </button>
            
            <!-- Products List -->
            <div id="mobile-products-list" class="flex flex-col items-start">
              <a
                href="/products/infra"
                class="gap-3 py-3 rounded-lg hover:bg-brand-blue/5 transition-colors"
              >
                <Image src={YInfraLogo} alt="Y_Infra" class="h-6 w-auto mb-2" />
                <p class="text-xs text-gray-600">
                  {products[0].description}
                </p>
              </a>
              
              <a
                href="/products/app"
                class="gap-3 py-3 rounded-lg hover:bg-brand-green/5 transition-colors"
              >
                <Image src={YAppLogo} alt="Y_App" class="h-6 w-auto mb-2" />
                <p class="text-xs text-gray-600">
                  {products[1].description}
                </p>
              </a>
              
              <a
                href="/products/ai"
                class="gap-3 py-3 rounded-lg hover:bg-brand-orange/5 transition-colors"
              >
                <Image src={YAiLogo} alt="Y_AI" class="h-6 w-auto mb-2" />
                <p class="text-xs text-gray-600">
                  {products[2].description}
                </p>
              </a>
              
              <a
                href="/products/ede"
                class="gap-3 py-3 rounded-lg hover:bg-brand-yellow/5 transition-colors"
              >
                
              <Image src={YEdeLogo} alt="Y_EDE" class="h-6 w-auto mb-2" />
              <p class="text-xs text-gray-600">
                {products[3].description}
              </p>
              </a>
            </div>
          </div>

          <!-- Other Navigation Links -->
          <a
            href="/culture-and-careers"
            class="block text-base text-gray-700 hover:text-brand-purple transition-colors py-2"
          >
            Culture / Careers
          </a>
          <a
            href="/contact"
            class="block text-base text-gray-700 hover:text-brand-purple transition-colors py-2"
          >
            Contact
          </a>

          <!-- Action Buttons -->
          <div class="pt-6 space-y-3 border-t border-gray-200">
            <a href="/contact"
              class="w-full inline-flex items-center justify-center rounded-full text-sm font-medium border border-primary bg-transparent hover:bg-primary/5 hover:text-primary transition-colors h-10 px-6 py-2"
            >
              Get Started
              <ArrowRightIcon class="w-4 h-4 ml-2" />
            </a>
            <!-- <button
              class="w-full inline-flex items-center justify-center rounded-full text-sm font-medium hover:bg-primary/5 hover:text-primary transition-colors h-10 px-6 py-2"
            >
              Log In
            </button> -->
          </div>
        </nav>
      </div>
    </div>

    <script>
      // Desktop mega menu functionality (for touch devices)
      const desktopProductsToggle = document.getElementById('desktop-products-toggle');
      const desktopMegaMenu = document.getElementById('desktop-mega-menu');
      const desktopProductsMenu = document.getElementById('desktop-products-menu');
      const desktopProductsArrow = document.getElementById('desktop-products-arrow');
      let isMegaMenuOpen = false;

      // Toggle mega menu on click/touch
      desktopProductsToggle?.addEventListener('click', (e) => {
        e.stopPropagation();
        isMegaMenuOpen = !isMegaMenuOpen;
        
        if (isMegaMenuOpen) {
          desktopMegaMenu?.classList.remove('opacity-0', 'invisible');
          desktopMegaMenu?.classList.add('opacity-100', 'visible');
          desktopProductsArrow?.classList.add('rotate-180');
        } else {
          desktopMegaMenu?.classList.add('opacity-0', 'invisible');
          desktopMegaMenu?.classList.remove('opacity-100', 'visible');
          desktopProductsArrow?.classList.remove('rotate-180');
        }
      });

      // Close mega menu when clicking outside
      document.addEventListener('click', (e) => {
        if (desktopProductsMenu && !desktopProductsMenu.contains(e.target as Node)) {
          if (isMegaMenuOpen) {
            isMegaMenuOpen = false;
            desktopMegaMenu?.classList.add('opacity-0', 'invisible');
            desktopMegaMenu?.classList.remove('opacity-100', 'visible');
            desktopProductsArrow?.classList.remove('rotate-180');
          }
        }
      });

      // Keep mega menu open when clicking inside it
      desktopMegaMenu?.addEventListener('click', (e) => {
        e.stopPropagation();
      });

      // Mobile menu functionality
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const mobileMenuClose = document.getElementById('mobile-menu-close');
      const mobileMenuBackdrop = document.getElementById('mobile-menu-backdrop');
      const mobileProductsToggle = document.getElementById('mobile-products-toggle');
      const mobileProductsList = document.getElementById('mobile-products-list');
      const mobileProductsArrow = document.getElementById('mobile-products-arrow');

      // Open mobile menu
      mobileMenuButton?.addEventListener('click', () => {
        mobileMenu?.classList.remove('translate-x-full');
        mobileMenuBackdrop?.classList.remove('opacity-0');
        document.body.style.overflow = 'hidden';
      });

      // Close mobile menu
      const closeMobileMenu = () => {
        mobileMenu?.classList.add('translate-x-full');
        mobileMenuBackdrop?.classList.add('opacity-0');
        document.body.style.overflow = '';
      };

      mobileMenuClose?.addEventListener('click', closeMobileMenu);
      mobileMenuBackdrop?.addEventListener('click', closeMobileMenu);

      // Toggle products dropdown
      mobileProductsToggle?.addEventListener('click', () => {
        mobileProductsList?.classList.toggle('hidden');
        mobileProductsArrow?.classList.toggle('rotate-180');
      });

      // Close menu when navigating to a page
      const mobileMenuLinks = mobileMenu?.querySelectorAll('a');
      mobileMenuLinks?.forEach(link => {
        link.addEventListener('click', () => {
          closeMobileMenu();
        });
      });
    </script>