---
/**
 * Dynamic page route using the NEW flexible Contentful architecture
 * 
 * This handles all pages dynamically based on their slug.
 * Examples: /products/ede, /about, /pricing, etc.
 */

 import type { GetStaticPaths } from 'astro';
import Layout from '@/layouts/Layout.astro';
import PostHogLayout from '@/layouts/PostHogLayout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import SectionRenderer from '@/components/SectionRenderer.astro';
import { getAllPages, getPageBySlug } from '@/lib/contentful-v2';
import type { ProcessedPage } from '@/types/contentful-v2';

// Fetch homepage data using new API
const slug = '/products/ede';
const page = await getPageBySlug(slug);

// Log status for debugging
if (page) {
  console.log('‚úÖ Contentful v2 data loaded successfully');
  console.log(`üìÑ Page: ${page.title}`);
  console.log(`üì¶ Sections: ${page.sections.length}`);
} else {
  console.log('‚ö†Ô∏è No Contentful v2 data found');
  console.log('üí° Make sure you have created a Page with slug "/" in Contentful');
}

// If no data, show helpful message
if (!page) {
  return Astro.redirect('/404');
}
---

<PostHogLayout>
  <Layout 
    title={page.title}
    description={page.metaDescription}
  >
    <Header />

    {page.sections.map((section) => (
      <SectionRenderer section={section} slug={slug} color="brand-yellow" />
    ))}

    <Footer />
  </Layout>
</PostHogLayout>

