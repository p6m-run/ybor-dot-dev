---
/**
 * page using the NEW flexible Contentful architecture
 *
 * This demonstrates how to use the new Page -> Section -> Component structure.
 * Once you've migrated your content, replace index.astro with this file.
 */

import Layout from "@/layouts/Layout.astro";
import PostHogLayout from "@/layouts/PostHogLayout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import SectionRenderer from "@/components/SectionRenderer.astro";
import { getPageBySlug } from "@/lib/contentful-v2";
import GradientBg from "@/components/GradientBg";

const slug = '/culture-and-careers';
const page = await getPageBySlug(slug);

// Log status for debugging
if (page) {
  console.log("âœ… Contentful v2 data loaded successfully");
  console.log(`ğŸ“„ Page: ${page.title}`);
  console.log(`ğŸ“¦ Sections: ${page.sections.length}`);
} else {
  console.log("âš ï¸ No Contentful v2 data found");
  console.log(
    'ğŸ’¡ Make sure you have created a Page with slug "/" in Contentful'
  );
}

// If no data, show helpful message
if (!page) {
  return Astro.redirect("/404");
}
---

<PostHogLayout>
  <Layout title={page.title} description={page.metaDescription}>
    <Header />

    <!-- Render all sections dynamically -->
    {
      page.sections.map((section) => (
        <SectionRenderer section={section} slug={slug} color="brand-purple" />
      ))
    }

    <GradientBg client:only="react" />
    <Footer />
  </Layout>
</PostHogLayout>

<style is:global>
  /* Add any page-specific styles here */
</style>
